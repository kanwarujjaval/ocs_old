yellow=angular.module("yellow",["angular-loading-bar","ngRoute","ngDialog","duScroll","headroom","angularFileUpload"]).value("duScrollDuration",2e3),yellow.run(function(o,t,e){o.$on("$routeChangeError",function(o,n,l,r){"noAuth"===r&&(e.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message">Not authorized</div></div>',!0,""),t.path(l?l.originalPath:"/"))})});var routeCheck={admin:{auth:function(o){return o.authorizeRole("admin")}},user:{auth:function(o){return o.authorize()}}};yellow.config(function(o,t,e){e.latencyThreshold=0,t.html5Mode({enabled:!0,requireBase:!1}),o.when("/",{templateUrl:"/partials/home",controller:"MainCtrl"}),o.when("/profile",{templateUrl:"/partials/profile",controller:"ProfileCtrl",resolve:routeCheck.user}),o.when("/editprofile",{templateUrl:"/partials/profileedit",controller:"ProfileEditCtrl",resolve:routeCheck.user}),o.when("/dashboard",{templateUrl:"/partials/dashboard",controller:"DashboardCtrl",resolve:routeCheck.user}),o.when("/course/create",{templateUrl:"/partials/createCourse",controller:"CreateCourseCtrl",resolve:routeCheck.user}),o.when("/course/edit/:id",{templateUrl:"/partials/createModule",controller:"CreateCourseCtrl",resolve:routeCheck.user}),o.when("/course/:id",{templateUrl:"/partials/singleCourse",controller:"SingleCourseCtrl",resolve:routeCheck.user}),o.when("/register/:token",{templateUrl:"/partials/register",controller:"RegisterCtrl"}),o.when("/admin",{templateUrl:"/partials/admin",controller:"AdminCtrl",resolve:routeCheck.admin}),o.when("/404",{templateUrl:"/partials/404"}),o.otherwise({redirectTo:"/404"})}),yellow.factory("apiService",function(o,t){return{post:function(e,n){return deferred=o.defer(),t.post(n,e).success(function(o,t,e){deferred.resolve(o)}).error(function(o,t,e){deferred.reject(t)}),deferred.promise},get:function(e){return deferred=o.defer(),t.get(e).success(function(o,t,e){deferred.resolve(o)}).error(function(o,t,e){deferred.reject(t)}),deferred.promise}}}),yellow.factory("authService",function(o,t,e){return{createUser:function(o){t.currentUser=o},destroyUser:function(){t.currentUser=void 0},authorizeRole:function(e){return t.isAuthorized(e)?!0:o.reject("noAuth")},authorize:function(){return t.isAuthenticated()?!0:o.reject("noAuth")}}}),yellow.factory("dialogService",function(o){return{dialogPlain:function(t,e,n){e&&o.closeAll(),o.open({template:t,plain:!0,closeByEscape:!0,controller:n})},closeAll:function(){o.closeAll()}}}),yellow.factory("htmlService",function(o){return{html:function(t){return returndata=o.trustAsHtml(t),returndata}}}),yellow.factory("session",function(o,t){var e;return t.ssu&&(e=t.ssu),{currentUser:e,isAuthenticated:function(){return!!this.currentUser},isAuthorized:function(o){return!!this.currentUser&&this.currentUser.roles.indexOf(o)>-1}}}),yellow.controller("AdminCtrl",function(o,t,e){t.get("/api/invites").then(function(t){o.inviteReq=t}),o.sendSignUpLink=function(o){t.post(o,"/sendtoken").then(function(o){o.errors?e.dialogPlain('<div class="ngdialog-message"><h3>'+o.message+"</h3></div>",!0,"AdminCtrl"):e.dialogPlain('<div class="ngdialog-message"><h3>'+o.message+"</h3></div>",!0,"AdminCtrl")},function(o){e.dialogPlain('<div class="ngdialog-message"><h3>ERROR IN RESPONSE</h3></div>',!0,"AdminCtrl")})}}),yellow.controller("CreateCourseCtrl",function(o,t,e,n,l,r){o.create=function(o){o.tags=o.tags.split(",");for(var e=0;e<o.tags.length;e++)o.tags[e]=o.tags[e].trim();t.post(o,"/api/course").then(function(o){o.errors?n.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>Error</h3><p>'+o.message+'</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="closeThisDialog()">Ok!</button></div>',!0,"CreateCourseCtrl"):(console.log(o._id),n.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>Course Created</h3><h3>Add the First Module</h3></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="goToModule(\''+o._id.trim()+"')\">Continue!</button></div>",!0,"CreateCourseCtrl"))},function(o){n.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3> Error '+o+'</h3><p>Server Error! Please try again later</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="closeThisDialog()">Ok!</button></div>',!0,"CreateCourseCtrl")})},o.goToModule=function(o){n.closeAll(),e.path("/course/edit/"+o)},o.pushModule=function(o){data={module:o,id:l.id},t.post(data,"/api/course/module").then(function(o){console.log(o)})};var i=function(t){o.upload=r.upload({url:t.upload_link_secure,method:"POST",file:file}).progress(function(o){console.log("percent: "+parseInt(100*o.loaded/o.total))}).success(function(o,t,e,n){console.log(t),console.log(o)})};o.onFileSelect=function(o){for(var e=0;e<o.length;e++){{o[e]}t.get("/api/course/module/genuptoken").then(i(response))}}}),yellow.controller("DashboardCtrl",function(o){}),yellow.controller("InviteCtrl",function(o,t,e,n){o.invite="Invite me",o.icon="arrow-right",o.clickToInvite=function(t){n.dialogPlain('<h3>Processing</h3><i class="fa fa-circle-o-notch fa-spin"></i>',!0,"InviteCtrl"),e.post(t,"/invite").then(function(t){t.errors?(confirmed=!1,n.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>'+t.message+'</h3><p>Error Processing your email address</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="openSecond('+confirmed+')">Ok!</button></div>',!0,"InviteCtrl")):(o.invite="Invited!",o.icon="smile-o",confirmed=!0,n.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>'+t.message+'</h3><p>We have signed you up for public beta,<br /> keep on eye on your email for more information.</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="openSecond('+confirmed+')">Ok!</button></div>',!0,"InviteCtrl"))},function(o){n.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3> Error '+o+'</h3><p>Server Error! Please try again later</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="openSecond('+!1+')">Ok!</button></div>',!0,"InviteCtrl")})},o.openSecond=function(o){o?n.dialogPlain('<h3>Share with your friends!</h3><a href="http://www.facebook.com/share.php?u=http://www.opencloudschool.org&title=I just signed up for Open Cloud School beta" target="_blank"><button class="btn-flat btn-fb"><i class="fa fa-facebook-square"></i> Share</button></a><a href="http://twitter.com/intent/tweet?url=http://www.opencloudschool.org/&text=I+just+signed+up+for+Open+Cloud+School+beta!&hashtags=OpenCloudSchool,Beta" target="_blank"><button class="btn-flat btn-twitter"><i class="fa fa-twitter-square"></i> Tweet</button></a>',!0):n.closeAll()}}),yellow.controller("LoginCtrl",function(o,t,e,n,l){o.login=function(o){e.dialogPlain('<h3>Processing</h3><i class="fa fa-circle-o-notch fa-spin"></i>',!0,"LoginCtrl"),t.post(o,"/login").then(function(o){o.errors?e.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>Error Logging in</h3><p>Please Try again !</p><p>'+o.message+'</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="closeThisDialog()">Ok!</button></div>',!0,"LoginCtrl"):(e.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>'+o.message+'</h3><h3>Continue to your dashboard</h3></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="gotodashboard()">Continue!</button></div>',!0,"LoginCtrl"),l.createUser(o.user))},function(o){e.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3> Error '+o+'</h3><p>Server Error! Please try again later</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="closeThisDialog()">Ok!</button></div>',!0,"LoginCtrl")})},o.gotodashboard=function(){n.path("/dashboard"),e.closeAll()}}),yellow.controller("MainCtrl",function(o){}),yellow.controller("ProfileCtrl",function(o,t){t.get("/api/profile").then(function(t){o.user=t})}),yellow.controller("ProfileEditCtrl",function(o){}),yellow.controller("RegisterCtrl",function(o,t,e,n,l){o.register=function(o){var l="/signup/"+e.token;n.dialogPlain('<h3>Processing</h3><i class="fa fa-circle-o-notch fa-spin"></i>',!0,"RegisterCtrl"),t.post(o,l).then(function(o){o.errors?(confirmed=!1,n.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>'+o.message+'</h3><p>Error Processing , Please Try again !</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="continue('+confirmed+')">Ok!</button></div>',!0,"RegisterCtrl")):(confirmed=!0,n.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>'+o.message+'</h3><p>You are now a part of the Open Cloud School community</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="continue('+confirmed+')">Ok!</button></div>',!0,"RegisterCtrl"))},function(o){console.log(response)})},o["continue"]=function(o){o?n.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>Continue to your dashboard</h3></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="gotodashboard()">Continue!</button></div>',!0,"RegisterCtrl"):n.closeAll()},o.gotodashboard=function(){l.path("/dashboard"),n.closeAll()}}),yellow.controller("SingleCourseCtrl",function(){}),yellow.controller("NavbarCtrl",function(o,t,e,n,l,r,i){o.session=l,o.onLanding="/"==e.path()?!0:!1,o.loginPopup=function(){t.open({template:"/partials/login.html",closeByEscape:!0,controller:"LoginCtrl"})},o.logout=function(){r.destroyUser(),i.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>Logged Out</h3></div></div>',!0,"LoginCtrl")},n.$on("$locationChangeSuccess",function(){o.onLanding="/"==e.path()?!0:!1})});