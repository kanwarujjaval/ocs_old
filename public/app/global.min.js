yellow=angular.module("yellow",["angular-loading-bar","ngRoute","ngDialog","duScroll","angularFileUpload"]).value("duScrollDuration",2e3),yellow.run(function($rootScope,$location,dialogService){$rootScope.$on("$routeChangeError",function(evt,current,previous,rejection){"noAuth"===rejection&&(dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message">Not authorized</div></div>',!0,""),$location.path(previous?previous.originalPath:"/"))})});var routeCheck={admin:{auth:function(authService){return authService.authorizeRole("admin")}},user:{auth:function(authService){return authService.authorize()}}};yellow.config(function($routeProvider,$locationProvider,cfpLoadingBarProvider){cfpLoadingBarProvider.latencyThreshold=0,$locationProvider.html5Mode({enabled:!0,requireBase:!1}),$routeProvider.when("/",{templateUrl:"/partials/home",controller:"MainCtrl"}),$routeProvider.when("/profile",{templateUrl:"/partials/profile",controller:"ProfileCtrl",resolve:routeCheck.user}),$routeProvider.when("/editprofile",{templateUrl:"/partials/profileedit",controller:"ProfileEditCtrl",resolve:routeCheck.user}),$routeProvider.when("/dashboard",{templateUrl:"/partials/dashboard",controller:"DashboardCtrl",resolve:routeCheck.user}),$routeProvider.when("/course/create",{templateUrl:"/partials/createCourse",controller:"CreateCourseCtrl",resolve:routeCheck.user}),$routeProvider.when("/course/edit/:id",{templateUrl:"/partials/createModule",controller:"CreateCourseCtrl",resolve:routeCheck.user}),$routeProvider.when("/course/:id",{templateUrl:"/partials/singleCourse",controller:"SingleCourseCtrl",resolve:routeCheck.user}),$routeProvider.when("/register/:token",{templateUrl:"/partials/register",controller:"RegisterCtrl"}),$routeProvider.when("/admin",{templateUrl:"/partials/admin",controller:"AdminCtrl",resolve:routeCheck.admin}),$routeProvider.when("/404",{templateUrl:"/partials/404"}),$routeProvider.otherwise({redirectTo:"/404"})}),yellow.controller("AdminCtrl",function($scope,apiService,dialogService){apiService.get("/api/invites").then(function(response){$scope.inviteReq=response}),$scope.sendSignUpLink=function(user){apiService.post(user,"/sendtoken").then(function(response){response.errors?dialogService.dialogPlain('<div class="ngdialog-message"><h3>'+response.message+"</h3></div>",!0,"AdminCtrl"):dialogService.dialogPlain('<div class="ngdialog-message"><h3>'+response.message+"</h3></div>",!0,"AdminCtrl")},function(response_error){dialogService.dialogPlain('<div class="ngdialog-message"><h3>ERROR IN RESPONSE</h3></div>',!0,"AdminCtrl")})}}),yellow.controller("CreateCourseCtrl",function($scope,apiService,$location,dialogService,$routeParams,$upload){$scope.create=function(course){course.tags=course.tags.split(",");for(var i=0;i<course.tags.length;i++)course.tags[i]=course.tags[i].trim();apiService.post(course,"/api/course").then(function(response){response.errors?dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>Error</h3><p>'+response.message+'</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="closeThisDialog()">Ok!</button></div>',!0,"CreateCourseCtrl"):(console.log(response._id),dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>Course Created</h3><h3>Add the First Module</h3></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="goToModule(\''+response._id.trim()+"')\">Continue!</button></div>",!0,"CreateCourseCtrl"))},function(response_error){dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3> Error '+response_error+'</h3><p>Server Error! Please try again later</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="closeThisDialog()">Ok!</button></div>',!0,"CreateCourseCtrl")})},$scope.goToModule=function(id){dialogService.closeAll(),$location.path("/course/edit/"+id)},$scope.pushModule=function(module){data={module:module,id:$routeParams.id},apiService.post(data,"/api/course/module").then(function(response){console.log(response)})};var upload=function(response){$scope.upload=$upload.upload({url:response.upload_link_secure,method:"POST",file:file}).progress(function(evt){console.log("percent: "+parseInt(100*evt.loaded/evt.total))}).success(function(data,status,headers,config){console.log(status),console.log(data)})};$scope.onFileSelect=function($files){for(var i=0;i<$files.length;i++){{$files[i]}apiService.get("/api/course/module/genuptoken").then(upload(response))}}}),yellow.controller("DashboardCtrl",function($scope){}),yellow.controller("InviteCtrl",function($scope,$q,apiService,dialogService){$scope.invite="Invite me",$scope.icon="arrow-right",$scope.clickToInvite=function(user){dialogService.dialogPlain('<h3>Processing</h3><i class="fa fa-circle-o-notch fa-spin"></i>',!0,"InviteCtrl"),apiService.post(user,"/invite").then(function(response){response.errors?(confirmed=!1,dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>'+response.message+'</h3><p>Error Processing your email address</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="openSecond('+confirmed+')">Ok!</button></div>',!0,"InviteCtrl")):($scope.invite="Invited!",$scope.icon="smile-o",confirmed=!0,dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>'+response.message+'</h3><p>We have signed you up for public beta,<br /> keep on eye on your email for more information.</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="openSecond('+confirmed+')">Ok!</button></div>',!0,"InviteCtrl"))},function(response_error){dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3> Error '+response_error+'</h3><p>Server Error! Please try again later</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="openSecond('+!1+')">Ok!</button></div>',!0,"InviteCtrl")})},$scope.openSecond=function(confirmed){confirmed?dialogService.dialogPlain('<h3>Share with your friends!</h3><a href="http://www.facebook.com/share.php?u=http://www.opencloudschool.org&title=I just signed up for Open Cloud School beta" target="_blank"><button class="btn-flat btn-fb"><i class="fa fa-facebook-square"></i> Share</button></a><a href="http://twitter.com/intent/tweet?url=http://www.opencloudschool.org/&text=I+just+signed+up+for+Open+Cloud+School+beta!&hashtags=OpenCloudSchool,Beta" target="_blank"><button class="btn-flat btn-twitter"><i class="fa fa-twitter-square"></i> Tweet</button></a>',!0):dialogService.closeAll()}}),yellow.controller("LoginCtrl",function($scope,apiService,dialogService,$location,authService){$scope.login=function(user){dialogService.dialogPlain('<h3>Processing</h3><i class="fa fa-circle-o-notch fa-spin"></i>',!0,"LoginCtrl"),apiService.post(user,"/login").then(function(response){response.errors?dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>Error Logging in</h3><p>Please Try again !</p><p>'+response.message+'</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="closeThisDialog()">Ok!</button></div>',!0,"LoginCtrl"):(dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>'+response.message+'</h3><h3>Continue to your dashboard</h3></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="gotodashboard()">Continue!</button></div>',!0,"LoginCtrl"),authService.createUser(response.user))},function(response_error){dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3> Error '+response_error+'</h3><p>Server Error! Please try again later</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="closeThisDialog()">Ok!</button></div>',!0,"LoginCtrl")})},$scope.gotodashboard=function(){$location.path("/dashboard"),dialogService.closeAll()}}),yellow.controller("MainCtrl",function($scope){}),yellow.controller("ProfileCtrl",function($scope,apiService){apiService.get("/api/profile").then(function(response){$scope.user=response})}),yellow.controller("ProfileEditCtrl",function($scope){}),yellow.controller("RegisterCtrl",function($scope,apiService,$routeParams,dialogService,$location){$scope.register=function(user){var path="/signup/"+$routeParams.token;dialogService.dialogPlain('<h3>Processing</h3><i class="fa fa-circle-o-notch fa-spin"></i>',!0,"RegisterCtrl"),apiService.post(user,path).then(function(response){response.errors?(confirmed=!1,dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>'+response.message+'</h3><p>Error Processing , Please Try again !</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="continue('+confirmed+')">Ok!</button></div>',!0,"RegisterCtrl")):(confirmed=!0,dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>'+response.message+'</h3><p>You are now a part of the Open Cloud School community</p></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="continue('+confirmed+')">Ok!</button></div>',!0,"RegisterCtrl"))},function(response_error){console.log(response)})},$scope["continue"]=function(confirmed){confirmed?dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>Continue to your dashboard</h3></div><button type="button" class="ngdialog-button ngdialog-button-primary" ng-click="gotodashboard()">Continue!</button></div>',!0,"RegisterCtrl"):dialogService.closeAll()},$scope.gotodashboard=function(){$location.path("/dashboard"),dialogService.closeAll()}}),yellow.controller("SingleCourseCtrl",function(){}),yellow.controller("NavbarCtrl",function($scope,ngDialog,$location,$rootScope,session,authService,dialogService){$scope.session=session,$scope.onLanding="/"==$location.path()?!0:!1,$scope.loginPopup=function(){ngDialog.open({template:"/partials/login.html",closeByEscape:!0,controller:"LoginCtrl"})},$scope.logout=function(){authService.destroyUser(),dialogService.dialogPlain('<div class="ngdialog-buttons"><div class="ngdialog-message"><h3>Logged Out</h3></div></div>',!0,"LoginCtrl")},$rootScope.$on("$locationC`angeSuccess",function(){$scope.onLanding="/"==$location.path()?!0:!1})}),yellow.factory("apiService",function($q,$http){return{post:function(data,path){return deferred=$q.defer(),$http.post(path,data).success(function(data,status,header){deferred.resolve(data)}).error(function(data,status,header){deferred.reject(status)}),deferred.promise},get:function(path){return deferred=$q.defer(),$http.get(path).success(function(data,status,header){deferred.resolve(data)}).error(function(data,status,header){deferred.reject(status)}),deferred.promise}}}),yellow.factory("authService",function($q,session,dialogService){return{createUser:function(user){session.currentUser=user},destroyUser:function(){session.currentUser=void 0},authorizeRole:function(role){return session.isAuthorized(role)?!0:$q.reject("noAuth")},authorize:function(){return session.isAuthenticated()?!0:$q.reject("noAuth")}}}),yellow.factory("dialogService",function(ngDialog){return{dialogPlain:function(data,closeprev,Ctrl){closeprev&&ngDialog.closeAll(),ngDialog.open({template:data,plain:!0,closeByEscape:!0,controller:Ctrl})},closeAll:function(){ngDialog.closeAll()}}}),yellow.factory("htmlService",function($sce){return{html:function(data){return returndata=$sce.trustAsHtml(data),returndata}}}),yellow.factory("session",function($http,$window){var currentUser;return $window.ssu&&(currentUser=$window.ssu),{currentUser:currentUser,isAuthenticated:function(){return!!this.currentUser},isAuthorized:function(role){return!!this.currentUser&&this.currentUser.roles.indexOf(role)>-1}}});